# Опис архітектури ProductCMS

## Загальний огляд

ProductCMS побудована за класичною **багатошаровою (layered) архітектурою** з використанням фреймворку Flask. Система слідує принципу **розділення відповідальності (Separation of Concerns)**, де кожен шар має свою чітко визначену роль.

---

## Шари архітектури

### 1. Client Layer (Клієнтський шар)

**Компоненти:**

- Web Browser (Десктопні браузери)
- Mobile Browser (Мобільні браузери)

**Опис:**
Точка входу для всіх користувачів системи. Клієнт відправляє HTTP запити до серверу та відображає отримані HTML сторінки. Підтримуються всі сучасні браузери з responsive дизайном.

**Технології:**

- HTML5, CSS3, JavaScript
- Bootstrap 5 для адаптивної верстки

---

### 2. Presentation Layer (Шар представлення)

**Компоненти:**

- **Flask Templates (Jinja2)** - динамічна генерація HTML
- **Static Files** - CSS стилі, JavaScript скрипти, статичні зображення

**Опис:**
Відповідає за відображення даних користувачеві. Jinja2 шаблони дозволяють створювати динамічний контент, вставляючи дані з бекенду. Статичні файли забезпечують стилізацію та інтерактивність.

**Приклад шаблонів:**

- `index.html` - головна сторінка з каруселлю
- `products.html` - каталог продуктів
- `admin_dashboard.html` - панель адміністратора

---

### 3. Application Layer (Прикладний шар)

**Компоненти:**

- **Route Handlers** - обробники маршрутів (endpoints)
- **Authentication Module** - автентифікація користувачів (Flask-Login)
- **Authorization Module** - перевірка прав доступу (декоратори)
- **Forms Module** - валідація форм (Flask-WTF)
- **File Upload Handler** - обробка завантажень (Werkzeug)

**Опис:**
Серце додатку, яке координує всі запити користувачів. Маршрути приймають запити, перевіряють права доступу, валідують дані та викликають бізнес-логіку.

**Приклади:**

```python
@app.route("/admin/add_product")
@login_required
def add_product():
    # Route handler обробляє запит

```

**Функції:**

- Маршрутизація запитів (`/`, `/products`, `/admin/*`)
- Управління сесіями користувачів
- CSRF захист форм
- Валідація введених даних
- Обробка файлів зображень

---

### 4. Business Logic Layer (Шар бізнес-логіки)

**Компоненти:**

- **Product Manager** - логіка управління продуктами
- **Carousel Manager** - логіка управління слайдами
- **User Manager** - логіка управління користувачами
- **Image Processing** - обробка зображень

**Опис:**
Містить всю бізнес-логіку додатку. Цей шар не залежить від конкретних технологій представлення або зберігання даних. Виконує валідацію бізнес-правил, трансформацію даних та координацію операцій.

**Приклади бізнес-правил:**

- Суперадміністратор не може видалити сам себе
- Суперадміністратор не може позбавити себе прав
- При видаленні продукту видаляється його зображення
- Зображення повинні бути у дозволених форматах

**Функції:**

- Валідація бізнес-правил
- Обробка та оптимізація зображень
- Санітизація назв файлів
- Координація складних операцій (наприклад, видалення з файлом)

---

### 5. Data Access Layer (Шар доступу до даних)

**Компоненти:**

- **SQLAlchemy ORM** - об'єктно-реляційне відображення

**Опис:**
Абстрагує роботу з базою даних, дозволяючи працювати з даними як з Python об'єктами. Забезпечує незалежність від конкретної СУБД.

**Моделі:**

```python
class Product(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100))
    desc = db.Column(db.Text)
    img = db.Column(db.String(100))

```

**Переваги:**

- Автоматична генерація SQL запитів
- Захист від SQL injection
- Легке переключення між СУБД
- Зручна робота з відношеннями

---

### 6. Database Layer (Шар бази даних)

**Компоненти:**

- **SQLite Database** - файлова база даних `database.db`

**Опис:**
Зберігає всі структуровані дані додатку. SQLite обрана для простоти розгортання та розробки.

**Таблиці:**

- `user` - адміністратори системи
- `product` - продукти каталогу
- `carousel_item` - слайди каруселі

**Характеристики:**

- Файлова БД (не потребує окремого сервера)
- ACID транзакції
- Легке резервне копіювання (один файл)

---

### 7. File Storage (Файлове сховище)

**Компоненти:**

- **static/img/** - директорія для завантажених зображень

**Опис:**
Зберігає всі завантажені користувачами зображення для продуктів та слайдів каруселі.

**Структура:**

```
static/
  └── img/
      ├── product1.jpg
      ├── product2.png
      ├── slide1.jpg
      └── ...

```

**Особливості:**

- Безпечні назви файлів (через `secure_filename`)
- Валідація типів файлів
- Автоматичне видалення при видаленні сутності

---

## Майбутні модулі (Заплановані)

### 8. REST API Module (тиждень 3)

**Технологія:** Flask-RESTful

**Опис:**
Забезпечить програмний доступ до даних системи для зовнішніх додатків та потенційних мобільних клієнтів.

**Endpoints:**

- `GET /api/products` - список продуктів
- `GET /api/products/<id>` - деталі продукту
- `GET /api/carousel` - слайди каруселі

**Формат:** JSON

---

### 9. Email Service (тиждень 7-8)

**Технологія:** Flask-Mail

**Опис:**
Надсилання email-нотифікацій адміністраторам та підтримка відновлення пароля.

**Функції:**

- Відновлення пароля
- Нотифікації про створення облікового запису
- Сповіщення про важливі події

---

### 10. Caching Layer (тиждень 6)

**Технологія:** Flask-Caching (Redis backend у production)

**Опис:**
Кешування часто запитуваних даних для покращення продуктивності.

**Що кешується:**

- Список продуктів (5 хв)
- Слайди каруселі (10 хв)
- Результати пошуку (2 хв)

---

### 11. Migration Tool (тиждень 6)

**Технологія:** Flask-Migrate (Alembic)

**Опис:**
Управління версіями схеми бази даних, дозволяє безпечно змінювати структуру БД у production.

**Переваги:**

- Історія змін схеми
- Відкат міграцій
- Безпечне оновлення продакшн БД

---

### 12. Audit Log Service (тиждень 4)

**Опис:**
Логування всіх дій адміністраторів для безпеки та відстеження змін.

**Що логується:**

- Створення/редагування/видалення продуктів
- Зміни користувачів
- Спроби несанкціонованого доступу

---

## Потоки даних

### Сценарій 1: Відвідувач переглядає головну сторінку

```
Browser → Flask Route (/)
  → Carousel Manager → SQLAlchemy
  → SQLite (carousel_items)
  → Template (index.html)
  → Browser (HTML)

```

### Сценарій 2: Адміністратор додає продукт

```
Browser → Flask Route (/admin/add_product)
  → @login_required → Forms Module (validate)
  → Image Processing → File Storage (save)
  → Product Manager → SQLAlchemy
  → SQLite (products)
  → Redirect → Browser

```

### Сценарій 3: Суперадміністратор видаляє адміністратора

```
Browser → Flask Route (/admin/delete_admin/<id>)
  → @login_required → @superuser_required
  → User Manager (business rules check)
  → SQLAlchemy → SQLite (users)
  → Flash message → Browser

```

---

## Принципи архітектури

### 1. Розділення відповідальності (Separation of Concerns)

Кожен шар має свою чітку відповідальність і не втручається в логіку інших шарів.

### 2. Слабка зв'язаність (Loose Coupling)

Шари взаємодіють через чіткі інтерфейси, що дозволяє легко замінювати компоненти.

### 3. Висока зв'язність (High Cohesion)

Пов'язаний функціонал згруповано разом (наприклад, вся логіка продуктів у Product Manager).

### 4. DRY (Don't Repeat Yourself)

Спільна логіка винесена в окремі функції та декоратори (наприклад, `@superuser_required`).

### 5. Безпека за замовчуванням

- CSRF токени в усіх формах
- Хешування паролів
- Валідація файлів
- Перевірка прав доступу

---

## Масштабування та еволюція

### Поточні обмеження:

- SQLite обмежує одночасний запис
- Файлове сховище на одному сервері
- Відсутність горизонтального масштабування

### Шлях до масштабування:

1. **Міграція на PostgreSQL** - для підтримки більшої кількості користувачів
2. **CDN для зображень** - Amazon S3 або Cloudinary
3. **Redis для кешування** - швидкий in-memory кеш
4. **Load Balancer** - розподіл навантаження між інстансами
5. **Асинхронні задачі** - Celery для обробки зображень

---

## Безпека архітектури

### Реалізовані механізми:

- Хешування паролів (werkzeug.security)
- CSRF захист (Flask-WTF)
- Валідація файлів за розширенням
- Санітизація назв файлів (secure_filename)
- Розділення прав доступу (roles)
- Захист роутів декораторами

### Заплановані покращення:

- Rate limiting (тиждень 4)
- MIME-type валідація (тиждень 4)
- Audit logging (тиждень 4)
- CSP headers (тиждень 4)
- Двофакторна автентифікація (довгостроково)

---

## Висновок

Архітектура ProductCMS побудована з урахуванням кращих практик веб-розробки та забезпечує:

- **Модульність** - легко додавати нові функції
- **Тестованість** - кожен шар можна тестувати окремо
- **Масштабованість** - чітка основа для зростання
- **Безпеку** - багаторівневий захист даних
- **Підтримуваність** - зрозуміла структура для команди
